# Wandb Sweep Configuration for Biolord
# Based on launch.json configuration

program: src/perturbench/modelcore/train.py
method: bayes  # Options: grid, random, bayes
metric:
  name: val_PCC_epoch  # Optimize for validation PCC
  goal: maximize

parameters:
  # Data configuration (fixed)
  data:
    value: mix_pert
  data.task:
    value: srivatsantrapnell2020_sciplex3
  data.data_path:
    value: /fs-computility-new/upzd_share/maoxinjie/AIVC/mxj/perturbench-main/data/all_cell_line_filterdrug.h5ad
  data.transform.use_covs:
    value: true
  
  # Model configuration (fixed)
  model:
    value: biolord
  model.use_mask:
    value: true
  model.use_cell_emb:
    value: false
  model.softplus_output:
    value: true
  
  # Hyperparameters to tune
  model.lr:
    distribution: log_uniform_values
    min: 1e-6
    max: 1e-3
  
  model.wd:
    distribution: log_uniform_values
    min: 1e-10
    max: 1e-6
  
  model.penalty_weight:
    distribution: log_uniform_values
    min: 0.1
    max: 100.0
  
  model.n_layers:
    values: [2, 3, 4]
  
  model.encoder_width:
    values: [512, 1024, 2048, 3072]
  
  model.latent_dim:
    values: [16, 32, 64, 128]
  
  model.dropout:
    distribution: uniform
    min: 0.0
    max: 0.3
  
  model.lr_scheduler_max_lr:
    distribution: log_uniform_values
    min: 1e-4
    max: 1e-2
  
  # Training configuration
  trainer.max_epochs:
    value: 10
  trainer.min_epochs:
    value: 0
  trainer.log_every_n_steps:
    value: 10
  trainer.devices:
    value: [0]
  
  # Data loading
  data.train_batch_size:
    values: [128, 256, 300]
  data.val_batch_size:
    value: 300
  data.test_batch_size:
    value: 300
  
  # Evaluation
  train:
    value: true
  test:
    value: true
  test_ckpt_type:
    value: pcc
  
  # Logger
  logger:
    value: wandb
  logger.wandb.project:
    value: perturbench
  logger.wandb.name:
    value: null  # Will be auto-generated by sweep

# Command template for Hydra
# Wandb will replace ${program} with the program path and ${args} with hyperparameter arguments
command:
  - python
  - ${program}
  - ${args}

